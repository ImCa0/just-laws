# 录入法律

## 技能描述

根据 contributing.md 规范，自动化收录中华人民共和国法律的流程。

**前提条件**：用户已通过 markitdown 将 DOCX 文件转换为 Markdown 文件，本技能负责格式化、整理和配置。

## 使用方法

调用本 skill 时需要提供以下参数：
- Markdown 文件路径（如 ".temp/laws/中华人民共和国爱国主义教育法_20231024.md"）
- laws-list.md 文件路径（用于查询法律分类，如 "laws-list.md"）

**说明**：
- 法律全名：从文件名或 md 内容中自动提取
- 英文名称：由 AI 自动翻译
- 法律分类：从 laws-list.md 中查询

## 执行流程

### 1. 确定法律信息

**从文件名或 md 内容中提取法律全名**：
- 优先从文件名中提取（如 `中华人民共和国爱国主义教育法_20231024.md` → `中华人民共和国爱国主义教育法`）
- 如果文件名不包含法律名称，从 md 文件的第一行或前几行提取
- 无需询问用户

**翻译英文名称**：
- 根据法律全名自动翻译为英文
- 遵循命名规范：全小写、连字符分隔、不含 "the"
- 示例：
  - `中华人民共和国爱国主义教育法` → `patriotism-education-law`
  - `中华人民共和国种子法` → `seed-law`
  - `中华人民共和国个人信息保护法` → `personal-information-protection-law`

**从 laws-list.md 查询法律分类**：
- 在用户提供的 laws-list.md 文件中搜索法律全名
- 从对应的分类章节中确定分类（如"社会法（30件）" → 社会法）
- 无需访问网站查询

**分类与目录映射**：
- **宪法相关法** → `constitutional-relevance`
- **民商法** → `civil-and-commercial`
- **行政法** → `administrative`
- **经济法** → `economic`
- **社会法** → `social`
- **刑法** → `criminal-law`
- **程序法** → `procedural`

### 2. 检查法律是否已存在

**重要**：在创建内容前，必须检查该法律是否已经被收录。

1. **检查文件系统**
   - 使用 Grep 在 `docs/` 目录中搜索法律全名
   - 如果找到文件，读取内容确认是否为同一法律

2. **检查配置文件**
   - 使用 Grep 在 `docs/.vuepress/config.js` 中搜索法律简称（不含"中华人民共和国"）
   - 检查是否已存在于导航配置中

3. **处理已存在的情况**
   - **如果法律已存在**：
     - 从当前 md 文件中提取生效日期（通常在立法修法记录中）
     - 从已有文件中提取生效日期
     - 对比两个日期，使用最新版本的文件
     - **默认分类是正确的，无需修改**
     - 如果新版本更新：
       * 备份旧文件（添加 .old 后缀）
       * 使用新文件替换旧文件
       * 更新 md 内容（如需要）
       * 提交时说明是更新内容
     - 如果版本相同或更旧：通知用户并停止操作

   - **如果法律不存在**：继续创建流程

### 3. 读取并整理 Markdown 内容

**重要提示**：
- ⚠️ **必须使用 AI 模型直接理解原始 md 文件并手动整理格式，不要使用脚本自动格式化**
- AI 对上下文的理解能力更强，能够更准确地处理特殊情况（如章节标题、条文嵌套、列表格式等）
- 脚本容易出现格式错误，需要反复调试；而 AI 可以一次性生成正确格式
- 使用 Read 工具读取原始文件，然后根据下方的格式要求，使用 Write 工具直接创建格式化后的文件

**读取源文件**：
- 使用 Read 工具读取用户提供的 md 文件
- 保存原始内容用于参考

**分析法律结构**：
- 统计条文数量（通过搜索 "**第" 确认）
- 提取立法修法记录（通常在文件开头）
- 确认章节结构（章、节）
- 判断是否需要拆分文件（200条以上）

**格式化内容**（严格执行）：

对于**少于 200 条**的法律，创建单个 `README.md` 文件。

**文件结构**：
```markdown
---
sidebar: auto
---

# 中华人民共和国{法律名称}

{立法修法记录 - 每条记录单独一行}

## 第一章　总则

**第一条**　条文内容...

**第二条**　条文内容...
```

**格式化规则（必须执行）**：

1. **Frontmatter**（必须第一行开始）：
   ```markdown
   ---
   sidebar: auto
   ---

   ```

2. **标题**（frontmatter 后空一行）：
   ```markdown
   # 中华人民共和国{法律名称}

   ```

3. **立法修法记录**：
   - 每条记录单独成行
   - 删除中文字符与数字之间的所有空格
   - 示例：`2021年8月20日第十三届全国人民代表大会常务委员会第三十次会议通过`
   - 最后一条记录后空一行

4. **章节标题**：
   - 使用 `## ` 级别（二级标题）
   - 保留原文格式，包括中文空格
   - 示例：`## 第一章　总则`（注意"章"字后是中文空格 `　`）
   - 节标题：`### 第一节　一般规定`
   - 章节标题后空一行

5. **条号格式**：
   - 使用加粗：`**第X条**`
   - 条号后跟中文空格 `　`（U+3000）
   - 示例：`**第一条**　为了保护个人信息权益...`

6. **空行规则（最重要）**：
   - **所有元素之间必须有空行**
   - frontmatter 与标题之间
   - 标题与立法记录之间
   - 立法记录与第一章之间
   - 章节标题与第一条之间
   - 条与条之间
   - 最后一条后不需要空行

7. **数字格式清理**：
   - 删除中文字符与数字之间的空格
   - 正则：`(\d+)\s+年` → `$1年`
   - 正则：`(\d+)\s+月` → `$1月`
   - 正则：`(\d+)\s+日` → `$1日`

对于**200 条以上**的法律：
- 告知用户需要拆分为多个 markdown 文件
- 参考 [民法典](docs/civil-and-commercial/civil-code/) 的结构
- 每一编创建一个独立的 markdown 文件
- 在 config.js 中配置侧边栏（sidebar）

### 4. 创建法律目录

创建目录：`docs/{分类}/{英文名称}/`

**目录命名规范**：
- 全小写字母
- 单词之间用连字符 `-` 分隔
- 不包含 "the" 或 "The People's Republic of China"
- 示例：`personal-information-protection-law`、`seed-law`

### 5. 创建格式化后的文件

使用 Write 工具创建 `docs/{分类}/{英文名称}/README.md` 文件，写入格式化后的内容。

**验证要点**：
- 确保文件已创建
- 确保格式符合规范
- 确保内容完整（所有章节、条文）

### 6. 更新导航配置

编辑 `docs/.vuepress/config.js`：

1. **找到对应的分类**（在 `navbar` 数组中）
2. **添加导航项**：
   ```javascript
   { text: "{法律简称}", link: "/{分类}/{英文名称}/" },
   ```

**重要注意事项**：
- `link` 路径必须以 `/` 开头
- `link` 路径必须以 `/` 结尾（表示目录）
- `link` 路径中**不能包含空格或中文**
- `text` 使用法律简称，通常省略"中华人民共和国"
- 示例：`{ text: "爱国主义教育法", link: "/social/patriotism-education-law/" }`

**验证配置**：
- 确保添加在正确的分类下
- 确保没有重复条目
- 确保文件路径与实际创建的路径一致

### 7. 更新项目 README

编辑根目录 `README.md`：

1. **更新计数**：
   - 找到 `已收录法律（x/292）`
   - 将数字加一（除非只是修正分类）

2. **添加法律条目**：
   - 在对应的分类下添加
   - 格式：`- [x] 中华人民共和国{法律名称}`
   - 缩进与其他条目保持一致

**检查点**：
- 确保添加在正确的分类下
- 确保没有重复条目
- 确保格式与其他条目一致

### 8. 验证并测试

**重要**：在提交前进行验证。

1. **文件验证**：
   - 确认 `docs/{分类}/{英文名称}/README.md` 文件存在
   - 确认文件格式正确（frontmatter、标题、空行）
   - 确认内容完整（所有章节、条文）

2. **链接验证**：
   - 确认 config.js 中的 link 路径与实际文件路径一致
   - 确认没有语法错误（JavaScript 语法）

3. **运行测试**（可选）：
   ```bash
   npm run docs:dev
   ```
   - 在浏览器中访问法律页面
   - 检查导航栏是否正确显示
   - 检查内容渲染是否正确

### 9. 提交代码

**重要**：提交时必须排除临时文件和辅助文件，只提交正式的法律文件和配置修改。

执行以下 git 命令：

```bash
# 只添加相关文件，排除临时文件
git add docs/ README.md .claude/skills/add_law.md
git commit -m "📘 收录《{法律名称}》"
```

**或者使用 .gitignore 排除临时文件**：

确保项目的 `.gitignore` 文件包含以下规则：
```
.temp/
*.pyc
__pycache__/
*.log
convert_*.py
format_*.py
process_*.py
batch_*.py
```

**提交信息规范**：
- 使用 emoji 书本系列（可选用不同颜色）：
  - 📘（蓝色书本）- 新增法律
  - 📗（绿色书本）- 新增法律
  - 📙（橙色书本）- 新增法律
  - 📕（红色书本）- 新增法律
- 法律名称使用书名号《》
- 格式：`{emoji} 收录《{法律名称}》`

**特殊情况**：
- 如果是更新内容：`git commit -m "📝 更新《{法律名称}》"`
- 如果是修正格式：`git commit -m "🔧 修正《{法律名称}》格式"`
- 如果是版本替换：`git commit -m "🔄 替换《{法律名称}》为最新版本"`

## 常见问题处理

### 问题 1：法律已存在但版本更新

**处理步骤**：
1. 对比新旧文件的生效日期
2. 备份旧文件（添加 .old 后缀）
3. 使用新文件替换旧文件
4. 保持原有的分类和配置
5. 提交时说明是更新版本

### 问题 2：Markdown 文件格式不规范

**处理步骤**：
1. 检查 frontmatter 是否存在且格式正确
2. 检查所有元素之间是否有空行
3. 检查条号是否加粗
4. 检查章节标题级别是否正确
5. 使用正则表达式批量修复常见问题

### 问题 3：条文数量超过 200 条

**处理步骤**：
1. 通知用户需要拆分文件
2. 分析法律的编、章结构
3. 为每一编创建独立的 markdown 文件
4. 在 config.js 中配置 sidebar
5. 参考民法典的实现方式

### 问题 4：链接路径错误

**处理步骤**：
1. 检查 link 路径是否以 `/` 开头和结尾
2. 检查路径中是否包含空格或中文
3. 检查实际文件路径是否与 link 一致
4. 使用正斜杠 `/` 而非反斜杠 `\`

## 注意事项

### 数据来源
- 用户已通过 markitdown 将 DOCX 转换为 Markdown
- 假设 DOCX 来源为权威渠道（全国人大官网或国家法律法规数据库）

### 格式细节
- **中文空格**：章标题和条号后的空格是中文空格 `　`（U+3000）
- **行间空行**：这是最常见的错误，确保所有元素之间都有空行
- **数字格式**：删除中文字符与数字之间的空格
- **链接路径**：不包含空格、中文，使用小写和连字符

### 命名规范
- **文件夹**：全小写，连字符分隔，不含 "the"
- **法律简称**：省略"中华人民共和国"，保留核心名称
- **文件路径**：使用正斜杠 `/`，不使用反斜杠 `\`

### 提交规范
- **emoji**：📘（新增）、🔄（修正）、📝（更新）
- **书名号**：使用中文书名号《》包裹法律名称
- **简洁明了**：提交信息应清晰说明做了什么

## 示例

### 示例 1：新增法律（少于200条）

用户输入：
```
Markdown 文件：.temp/laws/中华人民共和国爱国主义教育法_20231024.md
laws-list.md：laws-list.md
```

执行结果：
1. 提取法律全名：从文件名提取 → `中华人民共和国爱国主义教育法`
2. 翻译英文名称：`patriotism-education-law`
3. 查询分类：从 laws-list.md 查询 → 社会法
4. 检查是否存在：不存在
5. 读取 md 文件并格式化：
   - 提取立法修法记录
   - 格式化章节标题和条号
   - 确保所有元素之间有空行
   - 统计条文：40条（少于200条，无需拆分）
6. 创建目录：`docs/social/patriotism-education-law/`
7. 创建文件：`docs/social/patriotism-education-law/README.md`
8. 更新 config.js：在社会法分类下添加 `{ text: "爱国主义教育法", link: "/social/patriotism-education-law/" }`
9. 更新 README.md：计数+1，在社会法下添加条目
10. 验证：文件存在，链接正确，格式符合规范
11. 提交：`git commit -m "📘 收录《爱国主义教育法》"`（可选用 📗📙📕）

### 示例 2：新增法律（超过200条）

用户输入：
```
Markdown 文件：.temp/laws/中华人民共和国民法典_20200528.md
laws-list.md：laws-list.md
```

执行结果：
1. 提取法律全名：从文件名提取 → `中华人民共和国民法典`
2. 翻译英文名称：`civil-code`
3. 查询分类：从 laws-list.md 查询 → 民商法
4. 检查是否存在：不存在
5. 读取 md 文件并格式化：
   - 统计条文：1260条（超过200条）
   - 告知用户需要拆分文件
6. 分析结构：共7编，每创建一个独立文件
7. 创建目录：`docs/civil-and-commercial/civil-code/`
8. 创建文件：
   - `README.md`（总则）
   - `property-rights.md`（物权）
   - `contract.md`（合同）
   - `personality-rights.md`（人格权）
   - `marriage-and-family.md`（婚姻家庭）
   - `succession.md`（继承）
   - `tort-liability.md`（侵权责任）
9. 更新 config.js：配置 sidebar
10. 更新 README.md
11. 验证并提交：`git commit -m "📗 收录《民法典》"`

### 示例 3：更新已存在的法律

用户输入：
```
Markdown 文件：.temp/laws/中华人民共和国个人信息保护法_20240430.md
laws-list.md：laws-list.md
```

执行结果：
1. 提取法律全名：从文件名提取 → `中华人民共和国个人信息保护法`
2. 翻译英文名称：`personal-information-protection-law`
3. 查询分类：从 laws-list.md 查询 → 社会法
4. 检查是否存在：存在于 `docs/social/personal-information-protection-law/`
5. 对比生效日期：
   - 旧文件：2021年8月20日
   - 新文件：2024年4月30日
   - 新文件更新，执行替换
6. 备份旧文件：`README.md` → `README.md.old`
7. 格式化新文件内容并替换
8. 验证：文件格式正确，内容完整
9. 提交：`git commit -m "🔄 替换《个人信息保护法》为最新版本"`

## 技能完成标志

当以下所有步骤都完成时，技能执行成功：
- ✅ 法律文件已创建在正确的分类目录下
- ✅ 文件格式符合规范（frontmatter、空行、中文空格）
- ✅ 内容完整（所有章节、条文无缺失）
- ✅ config.js 已更新（link 路径正确）
- ✅ README.md 已更新（计数、条目）
- ✅ 无重复条目
- ✅ 代码已提交
